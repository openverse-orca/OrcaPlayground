{
  "description": "Fluid-MuJoCo 耦合仿真配置文件",
  
  "orcagym": {
    "address": "localhost:50051",
    "agent_name": "NoRobot",
    "env_name": "SimulationLoop"
  },
  
  "orcalink": {
    "enabled": true,
    "host": "localhost",
    "port": 50351,
    "auto_start": true,
    "startup_delay": 2,
    "command": "orcalink",
    "args": [],
    
    "client": {
      "session_id": 1,
      "client_name": "mujoco_client",
      "update_rate_hz": 50,
      "encoding": {
        "i_frame_interval": 30,
        "change_threshold": 0.001
      },
      "session": {
        "control_mode": "sync",
        "expected_clients": 2,
        "ready_timeout_sec": 30.0,
        "grpc_call_timeout_sec": 5.0,
        "async_params": {
          "flow_control_enabled": true,
          "flow_control_window_size": 10,
          "speed_ratio_threshold": 2.0,
          "comment": "异步模式参数：服务端中央流控"
        },
        "sync_params": {
          "sync_window_size": 1,
          "comment": "同步模式参数：客户端本地窗口大小（1~3）"
        },
        "comment": "control_mode: 'sync'=同步模式(客户端本地窗口控制), 'async'=异步模式(服务端中央流控)。grpc_call_timeout_sec: 单次gRPC调用超时（秒），防止服务器无响应时无限阻塞"
      }
    },
    
    "bridge": {
      "coupling_mode": "multi_point_force",
      "spring_constraint": {
        "channels": {
          "position": {
            "channel_id": 2,
            "publish": true,
            "subscribe": true,
            "comment": "MuJoCo发送和接收刚体位置：publish=发送本地位置给SPH, subscribe=接收SPH的位置用于计算弹簧力"
          }
        },
        "rigid_body_dynamics": {
          "mode": "internal",
          "force_smoothing_alpha": 0.3,
          "comment": "弹簧约束模式：MuJoCo侧不处理刚体动力学，仅作为位置源"
        },
        "force_clamping": {
          "enabled": true,
          "rigid_body": {
            "enabled": true,
            "max_acceleration_g": 10.0,
            "discard_on_clamp": true
          },
          "debug": {
            "log_clamped_forces": true,
            "log_threshold_n": 1000.0
          }
        }
      },
      "multi_point_force": {
        "channels": {
          "position": {
            "channel_id": 2,
            "publish": true,
            "subscribe": false,
            "comment": "MuJoCo发送SITE位置，接收SPH的MOCAP位置（用于可视化）"
          },
          "force": {
            "channel_id": 3,
            "publish": false,
            "subscribe": true,
            "comment": "MuJoCo接收SPH发送的多点力"
          }
        },
        "rigid_body_dynamics": {
          "mode": "external",
          "comment": "刚体动力学由MuJoCo主导"
        }
      }
    }
  },
  
  "orcasph": {
    "enabled": true,
    "auto_start": true,
    "command": "orcasph",
    "args": ["--gui"],
    "scene_auto_generate": true,
    
    "config": {
      "orcalink_client": {
        "session_id": 1,
        "client_name": "SPlisHSPlasH",
        "update_rate_hz": 50,
        "encoding": {
          "i_frame_interval": 30,
          "change_threshold": 0.001
        },
        "session": {
          "control_mode": "sync",
          "expected_clients": 2,
          "ready_timeout_sec": 30.0,
          "grpc_call_timeout_sec": 5.0,
          "async_params": {
            "flow_control_enabled": true,
            "flow_control_window_size": 10,
            "speed_ratio_threshold": 2.0
          },
          "sync_params": {
            "sync_window_size": 1
          }
        }
      },
      "orcalink_bridge": {
        "coupling_mode": "multi_point_force",
        "multi_point_force": {
          "channels": {
            "force": {
              "channel_id": 3,
              "publish": true,
              "subscribe": false,
              "comment": "SPH发送多点力给MuJoCo"
            },
            "position": {
              "channel_id": 2,
              "publish": false,
              "subscribe": true,
              "comment": "SPH接收位置来自MuJoCo"
            }
          },
          "force_decomposition": {
            "precompute_inverse": true,
            "regularization": 0.001
          },
          "rigid_body_dynamics": {
            "mode": "external",
            "comment": "刚体动力学由MuJoCo主导"
          }
        },
        "shared_modules": {
          "gravity": {
            "enable_rigid_body_gravity": false,
            "enable_rigid_body_collision": false,
            "anchor_particle_mass_ratio": 1.0
          },
          "force_clamping": {
            "enabled": true,
            "rigid_body": {
              "enabled": true,
              "max_acceleration_g": 10.0,
              "discard_on_clamp": true
            },
            "debug": {
              "log_clamped_forces": true,
              "log_threshold_n": 1000.0
            }
          }
        }
      },
      "physics": {
        "gravity": [0, 0, -9.81],
        "linear_damping": 0.01,
        "angular_damping": 0.01,
        "enable_debug_output": false,
        "physics_dt": 0.001
      },
      "debug": {
        "verbose_logging": true,
        "enable_spring_force_stats": true
      }
    }
  },
  
  "sph": {
    "scene_config": "scene_config.json",
    "include_fluid_blocks": true,
    "include_wall": true
  },
  
  "simulation": {
    "sync_mode": "spring_constraint",
    "timestep": 0.001,
    "substeps": 1
  },
  
  "debug": {
    "verbose_logging": false
  }
}
